#!/bin/bash
#  This script takes 3 parameters.  
# 1 - The name of the detector (ADProsilica, etc.)
# 2 - The version number (R2-0, etc.)
# 3 - The EPICS architecture (linux-x86_64, etc.)

echo "Parameter 1 = " $1
echo "Parameter 2 = " $2
echo "Parameter 3 = " $3

find . -name 'auto_settings.sav_*' -exec rm -fv {} \;
find . -name 'auto_settings.savB*' -exec rm -fv {} \;
find . -name 'core.*' -exec rm -fv {} \;
find . -name '*.exe.*' -exec rm -fv {} \;

AREA_DETECTOR=areaDetector-master
ASYN=asyn
AUTOSAVE=autosave
BUSY=busy
CALC=calc
DEVIOCSTATS=iocStats
SEQ=seq-2-2-5
SSCAN=sscan
BASE_TOP=/epics
BASE=base-7.0.1.1
SUPPORT=/home/mrolland/Documents/epics/synAppsRelease/synApps/support
DESTINATION=$1/$1_Prebuilt_$AREA_DETECTOR_$2_$3

mkdir -p $DESTINATION
HOME=$(pwd)

cd $DESTINATION
DESTINATION=$(pwd)
cd $HOME

cd $BASE_TOP
cp --parents -r -n $BASE/bin/$3 $DESTINATION
cp --parents -r -n $BASE/lib/$3 $DESTINATION
cd $SUPPORT
cp --parents -r -n $AREA_DETECTOR/ADCore/db $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADCore/documentation $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADCore/ADApp/Db $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADCore/ADApp/op $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADCore/iocBoot $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADViewers/ImageJ $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADCore/bin/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADCore/lib/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADSupport/bin/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/ADSupport/lib/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/db $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/bin/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/lib/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/documentation $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/iocs/*IOC/bin/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/iocs/*IOC/lib/$3 $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/iocs/*IOC/dbd $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/iocs/*IOC/iocBoot $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/*/Db $DESTINATION
cp --parents -r -n $AREA_DETECTOR/$1/*/op $DESTINATION
cp --parents -r -n $ASYN/opi $DESTINATION
cp --parents -r -n $ASYN/db $DESTINATION
cp --parents -r -n $ASYN/bin/$3 $DESTINATION
cp --parents -r -n $ASYN/lib/$3 $DESTINATION
cp --parents -r -n $AUTOSAVE/asApp/ $DESTINATION
cp --parents -r -n $AUTOSAVE/asApp/op $DESTINATION
cp --parents -r -n $AUTOSAVE/bin/$3 $DESTINATION
cp --parents -r -n $AUTOSAVE/lib/$3 $DESTINATION
cp --parents -r -n $BUSY/busyApp/Db $DESTINATION
cp --parents -r -n $BUSY/busyApp/op $DESTINATION
cp --parents -r -n $BUSY/bin/$3 $DESTINATION
cp --parents -r -n $BUSY/lib/$3 $DESTINATION
cp --parents -r -n $CALC/calcApp/Db $DESTINATION
cp --parents -r -n $CALC/calcApp/ $DESTINATION
cp --parents -r -n $CALC/bin/$3 $DESTINATION
cp --parents -r -n $CALC/lib/$3 $DESTINATION
cp --parents -r -n $DEVIOCSTATS/db $DESTINATION
cp --parents -r -n $DEVIOCSTATS/op/adl $DESTINATION
cp --parents -r -n $DEVIOCSTATS/bin/$3 $DESTINATION
cp --parents -r -n $DEVIOCSTATS/lib/$3 $DESTINATION
cp --parents -r -n $SEQ/bin/$3 $DESTINATION
cp --parents -r -n $SEQ/lib/$3 $DESTINATION
cp --parents -r -n $SSCAN/sscanApp/Db $DESTINATION
cp --parents -r -n $SSCAN/sscanApp/op $DESTINATION
cp --parents -r -n $SSCAN/bin/$3 $DESTINATION
cp --parents -r -n $SSCAN/lib/$3 $DESTINATION
cd $HOME
cp components/prebuilt_unique.cmd $DESTINATION/$AREA_DETECTOR/$1/iocs/*IOC/iocBoot/ioc*
cp components/prebuilt_config $DESTINATION/$AREA_DETECTOR/$1/iocs/*IOC/iocBoot/ioc*
